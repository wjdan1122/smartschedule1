# SMART Schedule Backend API

خادم خلفي لنظام إدارة الجداول الدراسية الذكي (SMART Schedule) متصل بقاعدة بيانات Baserow.

## متطلبات النظام

- Node.js (الإصدار 14 أو أحدث)
- npm أو yarn

## التثبيت والتشغيل

### 1. تثبيت التبعيات

```bash
cd server
npm install
```

### 2. إعداد متغيرات البيئة

انسخ ملف `.env` وقم بتعديل القيم المطلوبة:

```bash
cp .env .env.local
```

**المتغيرات المطلوبة:**
- `BASEROW_TOKEN`: رمز الوصول لقاعدة بيانات Baserow
- `JWT_SECRET`: مفتاح تشفير JWT (غير في الإنتاج)

### 3. تشغيل الخادم

**للتطوير:**
```bash
npm run dev
```

**للإنتاج:**
```bash
npm start
```

الخادم سيعمل على المنفذ 3000 افتراضياً.

## API Endpoints

### المصادقة
- `POST /api/auth/login` - تسجيل الدخول

### المقررات الاختيارية
- `GET /api/elective-courses` - جلب جميع المقررات الاختيارية
- `POST /api/elective-courses` - إضافة مقرر اختياري جديد (يتطلب كلمة مرور اللجنة)

### الطلاب
- `GET /api/students` - جلب جميع الطلاب
- `POST /api/students` - إضافة طالب جديد (يتطلب كلمة مرور اللجنة)

### التصويت
- `POST /api/vote` - تسجيل صوت لمقرر اختياري
- `GET /api/votes/:elective_course_id` - جلب أصوات مقرر معين

### الإشعارات
- `GET /api/notifications` - جلب جميع الإشعارات
- `POST /api/notifications` - إضافة إشعار جديد (يتطلب كلمة مرور اللجنة)

### الإحصائيات
- `GET /api/statistics` - جلب الإحصائيات العامة

### فحص الحالة
- `GET /api/health` - فحص حالة الخادم

## هيكل قاعدة البيانات (Baserow)

يجب إنشاء الجداول التالية في Baserow:

1. **users** (جدول المستخدمين)
2. **courses** (المقررات الأساسية)
3. **elective_courses** (المقررات الاختيارية)
4. **course_schedules** (جداول المقررات الزمنية)
5. **student_courses** (تسجيل الطلاب في المقررات)
6. **votes** (أصوات الطلاب)
7. **notifications** (الإشعارات)
8. **schedule_versions** (نسخ الجداول)
9. **schedule_details** (تفاصيل الجداول)

## ملاحظات مهمة

- تأكد من إعداد جداول Baserow بالحقول الصحيحة
- احتفظ برمز Baserow Token في مكان آمن
- غير JWT_SECRET في الإنتاج
- الخادم يدعم CORS للواجهات الأمامية

## استكشاف الأخطاء

### مشكلة في الاتصال بـ Baserow
- تأكد من صحة رمز الوصول (Token)
- تأكد من وجود الجداول المطلوبة في Baserow
- فحص معرف قاعدة البيانات (DATABASE_ID)

### مشكلة في تشغيل الخادم
- تأكد من تثبيت جميع التبعيات
- فحص متغيرات البيئة في ملف .env
- تأكد من عدم وجود عملية أخرى تستخدم المنفذ 3000
